#!/usr/bin/env -S streamlit run
from typing import reveal_type
import streamlit as st
# code adapted from https://developers.google.com/drive/api/guides/manage-uploads#python_1
import google.auth
from google.auth.exceptions import DefaultCredentialsError 
from googleapiclient.discovery import build # this is google-api-python-client
from googleapiclient.errors import HttpError
from googleapiclient.http import MediaIoBaseUpload
from io import StringIO
from cicero_shared import st_print

# Theoretically this may be used in Databricks or standalone instead of in streamlit. Not sure how we'll do the google auth for that, though...

st.warning("Hello. Almost nothing is here yet! And it only seems to work within GCP.")

example_document = """ <span style="float: right; overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 78.24px; height: 20.00px;"><img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASIAAABKCAYAAAAfblk1AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDhBMDk4RTdDMEE5MTFFOTlGNUNBQkVDRDQ3MDVFRUEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDhBMDk4RThDMEE5MTFFOTlGNUNBQkVDRDQ3MDVFRUEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpEOEEwOThFNUMwQTkxMUU5OUY1Q0FCRUNENDcwNUVFQSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpEOEEwOThFNkMwQTkxMUU5OUY1Q0FCRUNENDcwNUVFQSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpJjABwAABFbSURBVHja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" style="width: 78.24px; height: 20.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><b>Based example document enjoyer.</b><br> <i> seeing this document but don't expect to? Then something has gone wrong.</i>
"""

# code adapted from https://developers.google.com/drive/api/guides/manage-uploads#python_1
  
if st.button("Upload test file"):
  # Upload file with conversion
  
  # Todo(wyatt): figure this out:
  # Load pre-authorized user credentials from the environment.
  # TODO(developer) - See https://developers.google.com/identity
  # for guides on implementing OAuth2 for the application.

  creds, _ = google.auth.default() #this works in our deployed environment, but not in local testing (because in local testing, you aren't logged in! May need to revive the optional google login button if we want to fix that?)

  try:
    # create drive api client
    service = build("drive", "v3", credentials=creds)
    # here for testing purposes.
    st_print(service.about())
    reveal_type(service.about())
    st_print(service.about().get())
    reveal_type(service.about().get())
    
    # On GCP we seem to get this far, at least.
    file_metadata = {
        "name": "Cool Example Document",
        "mimeType": "application/vnd.google-apps.document",
    }
    media = MediaIoBaseUpload(StringIO('example_document'), mimetype="text/html", resumable=True)
    file = (
        service.files()
        .create(body=file_metadata, media_body=media, fields="id")
        .execute()
    )
    st_print(f'File with ID: "{file.get("id")}" has been uploaded.')
    reveal_type(file)
  except HttpError as error:
    st_print(f"An HTTP error occurred: {error}")
  except DefaultCredentialsError as e:
    st_print(f"An error occurred (probably because you're not logged in to google in local testing!): {e}")

